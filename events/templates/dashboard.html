{% extends "template.html" %}
{% block content %}

    {% comment %} For Deleting a event 
    <a href="{% url "delete-event" event.id %}">
    </a>
    {% endcomment %}

    {% comment %} For Editing an event 
    <a href="{% url "edit-event" event.id %}">        
    </a>
    {% endcomment %}

    {% comment %} For Viewing event details 
    <a href="{% url "event-details" event.id %}">  
    </a>
    {% endcomment %}
    {% comment %} Stats Cards {% endcomment %}
    <div class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 p-4">
        <div class="h-auto grid grid-cols-2 bg-slate-800/50 backdrop-blur-lg p-4 rounded-xl border border-slate-700/40 text-slate-100 items-center">
            <div>
                <p class="font-bold text-sm text-center mb-1 text-slate-300">Total<br>Participants</p>
                <p class="text-5xl text-center text-blue-400">{{ count.participants_cnt }}</p>
            </div>
            <div class="justify-self-center h-20 w-20 p-3 bg-blue-500/20 backdrop-blur-sm rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-10 text-blue-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" />
            </svg>
            </div>
        </div>
        <a
        href="?filter_events=All Events{% if category_id %}&category={{ category_id }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">
        <div class="cursor-pointer h-auto grid grid-cols-2 bg-slate-800/50 backdrop-blur-lg p-4 rounded-xl border border-slate-700/40 text-slate-100 items-center hover:bg-slate-700/50 transition-colors">
            <div>
                <p class="font-bold text-sm text-center mb-1 text-slate-300">Total<br>Events</p>
                <p class="text-5xl text-center text-blue-400">{{ count.total_events }}</p>
            </div>
            <div class="justify-self-center h-20 w-20 p-3 bg-blue-500/20 backdrop-blur-sm rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-10 text-blue-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
            </svg>
            </div>

        </div>
        </a>
        <a href="?filter_events=Upcoming Events{% if category_id %}&category_id={{ category_id }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">
        <div class="cursor-pointer h-auto grid grid-cols-2 bg-slate-800/50 backdrop-blur-lg p-4 rounded-xl border border-slate-700/40 text-slate-100 items-center hover:bg-slate-700/50 transition-colors">
            <div>
                <p class="font-bold text-sm text-center mb-1 text-slate-300">Upcoming<br>Events</p>
                <p class="text-5xl text-center text-blue-400">{{ count.upcoming_events }}</p>
            </div>
            <div class="justify-self-center h-20 w-20 p-3 bg-blue-500/20 backdrop-blur-sm rounded-full flex items-center justify-center ">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-10 text-blue-400">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061A1.125 1.125 0 0 1 3 16.811V8.69ZM12.75 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061a1.125 1.125 0 0 1-1.683-.977V8.69Z" />
                </svg>
                </div>
        </div>
        </a>
        <a href="?filter_events=Past Events{% if category_id %}&category_id={{ category_id }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">
        <div class="cursor-pointer h-auto grid grid-cols-2 bg-slate-800/50 backdrop-blur-lg p-4 rounded-xl border border-slate-700/40 text-slate-100 items-center hover:bg-slate-700/50 transition-colors">
            <div>
                <p class="font-bold text-sm text-center mb-1 text-slate-300">Past<br>Events</p>
                <p class="text-5xl text-center text-blue-400">{{ count.past_events }}</p>
            </div>
            <div class="justify-self-center h-20 w-20 p-3 bg-blue-500/20 backdrop-blur-sm rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-10 text-blue-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 16.811c0 .864-.933 1.406-1.683.977l-7.108-4.061a1.125 1.125 0 0 1 0-1.954l7.108-4.061A1.125 1.125 0 0 1 21 8.689v8.122ZM11.25 16.811c0 .864-.933 1.406-1.683.977l-7.108-4.061a1.125 1.125 0 0 1 0-1.954l7.108-4.061a1.125 1.125 0 0 1 1.683.977v8.122Z" />
            </svg>
            </div>
        </div>
        </a>
    </div>

    {% comment %} search bar {% endcomment %}
    <div class="grid md:grid-cols-1 lg:grid-cols-6 gap-4 p-4 items-center justify-evenly">
        <h2 class="text-2xl font-bold text-slate-100">{{ filter_events|default:"Today's Events" }}</h2>
        <div class="col-span-4">
            <form method="GET" action="{% url 'dashboard' %}"
                class="flex bg-slate-800/50 backdrop-blur-lg border border-slate-700/40 rounded-full px-2 py-1">

                {% if filter_events %}
                    <input type="hidden" name="filter_events" value="{{ filter_events }}">
                {% endif %}

                {% if category_id %}
                    <input type="hidden" name="category" value="{{ category_id }}">
                {% endif %}

                <input
                    type="text"
                    name="search"
                    placeholder="Search events..."
                    value="{{ search_query }}"
                    class="focus:outline-none w-full rounded px-2 py-1 bg-transparent text-slate-100 placeholder-slate-400"
                >

                <button type="submit"
                    class="bg-gradient-to-r from-blue-500/70 to-indigo-500/70 hover:from-blue-600/90 hover:to-indigo-600/90 backdrop-blur-sm h-10 w-10 text-white font-bold rounded-full flex items-center justify-center ml-2 transition-all duration-200 shadow-lg hover:shadow-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                    </svg>
                </button>
            </form>

        </div>
        <a href="{% url 'event_form' %}" class="bg-gradient-to-r from-green-500/70 to-emerald-500/70 hover:from-green-600/90 hover:to-emerald-600/90 backdrop-blur-sm text-white font-bold rounded-full py-2 px-4 text-center transition-all duration-200 shadow-lg">+ New Event</a>
    </div>

    {% comment %} Categories {% endcomment %}
    <div class="flex flex-col p-4 items-center">
        <p class="px-3 font-bold text-xl mb-3 text-slate-100"> Categorys : </p>
        <div class="mx-3 flex flex-wrap gap-2">
        {% for category in categories %}
            <a href="{% url 'dashboard' %}?category={{ category.id }}{% if filter_events %}&filter_events={{ filter_events }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" 
            class="hover:bg-blue-600/70 bg-blue-600/50 backdrop-blur-sm text-white px-2 py-1 rounded-full mr-2 transition-colors">
                {{ category.name }}
            </a>
        {% endfor %}
        <a href="{% url 'dashboard' %}{% if filter_events %}?filter_events={{ filter_events }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" 
            class="hover:bg-slate-600/70 bg-slate-600/50 backdrop-blur-sm text-white px-2 py-1 rounded-full mr-2 transition-colors">
                All
        </a>

        </div>
    </div>

    {% comment %} event cards {% endcomment %}
    <div class="grid md:grid-cols-1 lg:grid-cols-2 gap-4 p-4">
    {% for event in Events %}
            <div onclick="window.location.href='{% url "event-details" event.id %}'" class="grid md:grid-cols-1 lg:grid-cols-2 hover:bg-slate-700/50 bg-slate-800/50 backdrop-blur-lg p-4 rounded-xl border border-slate-700/40 text-slate-100 transition-colors cursor-pointer">
                <div>
                <p class="font-bold text-2xl text-slate-100">{{event.name}}</p><br>
                <p class="font-bold text-slate-300">Category: <span class="bg-blue-500/50 backdrop-blur-sm text-white px-2 py-1 rounded-full">{{event.category.name}}</span></p>
                <p class="my-2 text-slate-300">Date: {{event.date}}</p>
                <p class="my-2 text-slate-300">Time: {{event.time}}</p>
                <p class="my-2 text-slate-300">Location: {{event.location}}</p>
                <div class="my-4">
                    <a href="{% url 'edit-event' event.id %}" class="hover:shadow-lg bg-gradient-to-r from-blue-500/70 to-cyan-500/70 hover:from-blue-600/90 hover:to-cyan-600/90 backdrop-blur-sm text-white font-bold py-2 px-4 rounded-full mr-2 transition-all duration-200 shadow-md">Edit</a>
                    <a href="{% url 'delete-event' event.id %}?next={{ request.get_full_path }}" class="hover:shadow-lg bg-gradient-to-r from-red-500/70 to-pink-500/70 hover:from-red-600/90 hover:to-pink-600/90 backdrop-blur-sm text-white font-bold py-2 px-4 rounded-full transition-all duration-200 shadow-md">Delete</a>
                </div>
                </div>
                <div>
                    <div>
                        {% if event.image %}
                            <img src="{{ event.image.url }}" alt="{{ event.name }}" class="mb-4 w-full h-40 rounded object-scale-down border border-slate-700/40">
                        {% else %}
                            <div class="mb-4 w-full h-40 bg-slate-700/30 backdrop-blur-sm flex items-center justify-center rounded border border-slate-700/40">
                                <span class="text-slate-400">No Image Available</span>
                            </div>
                        {% endif %}
                    </div>
                    <div class="flex justify-center items-center">
                        <div class="h-10 w-10 bg-blue-500/20 backdrop-blur-sm rounded-full flex items-center justify-center mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-blue-400">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z" />
                            </svg>
                        </div>
                        <p class="text-slate-300"><span class="font-bold text-slate-100">{{ event.participants.count }}</span> People</p>
                    </div>
                </div>
            </div>
    {% endfor %}
    </div>

{% endblock %}